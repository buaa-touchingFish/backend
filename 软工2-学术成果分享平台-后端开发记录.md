## 创建项目

![image-20231008101601770](C:\Users\mczzy\AppData\Roaming\Typora\typora-user-images\image-20231008101601770.png) 

勾选要使用的框架技术：web服务，mysql驱动，lombok注解，redis 、es的java客户端

## 添加额外的maven依赖

mybatis-plus   hutool  alibaba Druid数据源    common-pool2数据源   jackson(json数据与java对象转化)

## 填写配置文件

mysql数据库连接(更改数据源)、redis数据库连接

## 命名规范

​	类名、包名大驼峰命名法， 函数名、变量名小驼峰命名法，虽然这么规定，但是很多时候并不能遵守，比如数据库的字段名都是小写的，所以PO层对象为了和数据表字段进行对应不得不采用一样的命名，虽然可以用@TableField进行映射，但是不如直接一步到位采用一样的命名，而且其实都用了@Data注解或者直接生成Getter方法，对应成员变量的取用也跟命名无关了

## 功能细节

### 注册

​	与上学期的机票预订系统和小学期的融创不同，我觉得那两个注册要填写的信息过多了，很影响用户体验，再加上短信业务受限(需要身份验证＋收钱)，于是模仿知网的登录采用了用户名＋密码＋邮箱的注册方式；

流程: 输入用户名、密码、邮箱 点击发送邮箱，会生成验证码发送到指定邮箱(邮箱不能重复)，有效时间是3min(可以修改)，然后填入验证码进行注册，如果用户名没有重复并且验证码正确就会注册成功。在之前验证码是存在mysql数据库中的，每次从数据库中去查，但这样在数据量大的时候是很慢的，所以这次我把验证码存储在了redis数据库中，刚好redis也支持过期。

### 登录

​	登录比注册要复杂一些，登录就是输入用户密码，登陆成功后会生成token,token中存储了登录用户的用户名信息，将token返回给前端，以后每次请求需要登录才能访问的数据就带上token,token有效时可以直接访问，过期后状态码为403,需要重新登录。注意当登录成功时会将该用户信息转成json字符串以用户名作为key存放在redis中，有效时间设置成token有效时间。

​	在实现上，为了模仿出之前项目中python装饰器@LoginCheck的效果，编写了自定义注解@LoginCheck，然后编写拦截器，对于识别出添加了@LoginCheck的Controller中的方法会检查是否携带了token并且要进行token有效性检查，当token有效时解析出token中携带的用户名信息，从redis中取出该用户还原为user对象存放到Threadlocal中，这样在Controller方法中就可以直接使用当前user对象了，跟之前python项目中的用法基本一样。



## 文章数据处理

### 数据存储

​	因为搜索是这个平台的核心功能之一，想要实现高性能且较为全面的搜索，是一定得用elasticsearch的，我初步构想得把文章存储成文章名  、文章领域(标签)、文章作者、文章内容、发表的期刊/会议  具体实现可以参考一下谷歌学术啥的；但是es是不能当数据库使的，文章数据还是得放在mysql里，所以就涉及到了数据同步问题，我们使用logstash进行数据同步。
